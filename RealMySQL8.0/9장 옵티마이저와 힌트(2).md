## 9.2.5 DISTINCT 처리
- 특정 칼럼의 유니크한 값만 조회하려면 SELECT 쿼리에 DISTINCT를 사용.
- DISTINCT는 MIN(),MAX() 또는 COUNT() 같은 집합 함수와 함께 사용되는 경우아 집합 함수가 없는 2가지 구분으로 살펴본다
- DISTICT처리가 인덱스를 사용하지 못하면 항상 임시 테이블이 필요하다. 하지만 실행 계획의 Extra칼럼에는 Using temporary가 출력x

### 9.2.5.1 SELECT DISTINCT
- 단순히 SELECT 되는 레코드 중에서 유니크한 레코드만 가져오고자 하면 GROUP BY와 동일한 방식으로 처리됨.
- 특히 MySQL 8.0버전부터는 GROUP BY를 수행하는 쿼리에 ORDER BY절이 없으면 정렬을 사용하지 않기 때문에 다음의 두 쿼리는 내부적으로 같은 작업을 수행함.

``` sql
SELECT DISTINCT emp_no FROM salaries;
SELECT emp_no FROM salaries GROUP BY emp_no;
```
#### 주의사항
``` sql
SELECT DISTINCT(first_name), last_name FROM employees;
```
- 위의 쿼리는 (first_name,last_name) 조합 전체가 유니크한 레코드를 가져오는 것이다.
- DISTICT 키워드는 조회되는 모든 칼럼에 영향을 미친다. 절대로 SELECT하는 여러 칼럼 중에서 일부 칼럼만 유니크하게 조회하는게 아니다.
- 단 이어서 설명할 집합 함수와 함께 사용하게 된 DISTINCT의 경우 조금 다름.

### 9.2.5.2 집합 함수와 함께 사용된 DISTINCT
- COUNT(),MIN(),MAX() 와 같은 집합 함수 내에서 DISTINCT 키워드가 사용될 경우 SELECT DISTINCT와 다른 형태로 해석됨.

``` sql
EXPLAIN SELECT COUNT(DISTINCT s,salary)
FROM employees e, salaries s
WHERE e.emp_no=s.emp_no
AND e.emp_no BETWEEN 100001 AND 100100;
```
- 이 쿼리는 내부적으로 COUNT(DISTINCT s,salary)를 처리하기 위해 임시 테이블을 사용하지만 실행 계획에서는 임시테이블 사용 메시지가 표시되지 않음.
- 위 쿼리의 경우 employees 테이블과 salaries 테이블을 조인한 결과에서 salary 칼럼의 값만 저장하기 위한 임시 테이블을 만들어서 사용한다.
- 이 때, 임시 테이블의 salary 칼럼에는 유니크 인덱스가 생성되므로 레코드 건수가 많으면 상당히 느려질 수 있다.

#### 개선

``` sql
SELECT COUNT(DISTINCT emp_no) FROM employees;
SELECT COUNT(DISTINCT emp_no) FROM dept_emp GROUP BY dept_no;
```
- 다음 쿼리와 같이 인덱스된 칼럼에 대해 DISTINCT 처리를 수행할 때는 Index full scan or range scan
## 9.2.6 내부 임시 테이블 확용
- MySQL 엔진이 스토리지 엔진으로부터 받아온 레코드를 정렬하거나 그루핑할 때는 내부적인 임시 테이블을 사용함
- 임시 테이블은 처음에 메모리에 생성됐다가 테이블 크기가 커지면 디스크로 옮겨짐.
- 바로 디스크에서 만들어지는 경우도 존재
- 쿼리의 처리가 완료되면 자동으로 삭제됨
### 9.2.6.1 메모리 임시 테이블과 디스크 임시 테이블




